import React,{useMemo} from 'react';
import {useDispatch,useSelector} from 'react-redux';
import {toggleCart} from '../../redux/uiSlice';
import ProgressBar from '../ui/ProgressBar';
const FREE_SHIP_THRESHOLD=500;
const CartDrawer=()=>{const dispatch=useDispatch();const open=useSelector(s=>s.ui.cartOpen);const products=useSelector(s=>s.orebiReducer.products||[]);const total=useMemo(()=>products.reduce((s,p)=>s+(Number(p.price)||0),0),[products]);const remaining=Math.max(0,FREE_SHIP_THRESHOLD-total);return(<div aria-hidden={!open} className='fixed inset-0 z-[var(--z-drawer)] pointer-events-none'><div onClick={()=>dispatch(toggleCart(false))} className={`absolute inset-0 bg-black/40 transition-opacity ${open?'opacity-100 pointer-events-auto':'opacity-0'}`}/><aside className={`absolute top-0 right-0 h-full w-full max-w-md bg-white shadow-lg flex flex-col transform transition-transform duration-300 pointer-events-auto ${open?'translate-x-0':'translate-x-full'}`}><header className='p-4 border-b flex items-center justify-between'><h2 className='text-lg font-semibold'>Your Cart</h2><button onClick={()=>dispatch(toggleCart(false))} className='text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]'>Close</button></header><div className='p-4 border-b'>{total<FREE_SHIP_THRESHOLD?(<p className='text-sm mb-2'>Add <span className='font-semibold'>Rs.{remaining}</span> more for free shipping</p>):(<p className='text-sm text-[var(--color-success)] font-medium mb-2'>You unlocked free shipping!</p>)}<ProgressBar value={Math.min(total,FREE_SHIP_THRESHOLD)} max={FREE_SHIP_THRESHOLD}/></div><div className='flex-1 overflow-y-auto p-4 space-y-4'>{products.length===0&&<p className='text-sm text-[var(--color-text-secondary)]'>Your cart is empty.</p>}{products.map(p=>(<div key={p._id||p.id} className='flex gap-3 items-start border-b pb-3'><img src={p.image||p.img||p.images} alt={p.name} className='w-16 h-16 object-cover rounded-md bg-[var(--color-neutral-100)]'/><div className='flex-1'><p className='font-medium text-sm line-clamp-2'>{p.name||p.productName}</p><p className='text-xs text-[var(--color-text-secondary)]'>Rs.{p.price}</p></div></div>))}</div><footer className='p-4 border-t space-y-3'><div className='flex justify-between text-sm'><span>Total</span><span className='font-semibold'>Rs.{total}</span></div><button className='w-full h-11 rounded-md bg-[var(--color-brand-primary)] text-white font-medium hover:bg-[var(--color-brand-primary-hover)] transition-colors'>Checkout</button></footer></aside></div>);};
export default CartDrawer;
